{% set name = "fastlowess" %}
{% set version = "0.99.7" %}

package:
  name: {{ name|lower }}
  version: {{ version }}

source:
  url: https://github.com/thisisamirv/lowess-project/archive/v{{ version }}.tar.gz
  sha256: 0fb34cc1f06cf38116505316c47d3beb990df393ebea68396fd3fb1d559c56de

build:
  number: 0

outputs:
  - name: libfastlowess
    script: build_cpp.sh  # [unix]
    script: build_cpp.bat  # [win]
    build:
      run_exports:
        - {{ pin_subpackage('libfastlowess', max_pin='x.x') }}
    requirements:
      build:
        - {{ compiler('cxx') }}
        - {{ stdlib("c") }}
        - {{ compiler('rust') }}
        - cmake
        - make  # [unix]
        - cargo-bundle-licenses
    test:
      commands:
        - test -f ${PREFIX}/include/fastlowess.hpp  # [unix]
        - test -f ${PREFIX}/lib/libfastlowess_cpp.so  # [linux]
        - test -f ${PREFIX}/lib/libfastlowess_cpp.dylib  # [macos]
        - if not exist %LIBRARY_INC%\\fastlowess.hpp exit 1  # [win]
        - if not exist %LIBRARY_BIN%\\fastlowess_cpp.dll exit 1  # [win]
        - if not exist %LIBRARY_LIB%\\fastlowess_cpp.lib exit 1  # [win]

  - name: fastlowess
    script: build_py.sh  # [unix]
    script: build_py.bat  # [win]
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib("c") }}
        - {{ compiler('rust') }}
        - cargo-bundle-licenses
      host:
        - python
        - pip
        - maturin >=1.0,<2.0
      run:
        - python
        - numpy >=1.20.0
    test:
      imports:
        - fastlowess

  - name: r-fastlowess
    script: build_r.sh  # [unix]
    script: build_r.bat  # [win]
    requirements:
      build:
        - {{ compiler('c') }}
        - {{ stdlib("c") }}
        - {{ compiler('rust') }}
        - make  # [unix]
      host:
        - r-base
        - r-rcpp
      run:
        - r-base
        - r-rcpp
    test:
      commands:
        - $R -e "library('fastlowess')"  # [not win]
        - "\"%R%\" -e \"library('fastlowess')\""  # [win]

about:
  home: https://github.com/thisisamirv/lowess-project
  license: MIT AND Apache-2.0
  license_file:
    - LICENSE-MIT
    - LICENSE-APACHE
    - THIRDPARTY.yml
  summary: High-performance LOWESS smoothing for Rust, Python, and R

extra:
  recipe-maintainers:
    - thisisamirv
